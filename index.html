<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>mnote001 | Cloud Portfolio</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        :root { --gold: #facc15; --bg: #030712; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: #f1f5f9; -webkit-tap-highlight-color: transparent; height: 100%; }
        .balance-gradient { background: linear-gradient(135deg, #1d4ed8 0%, #a855f7 100%); border: 1px solid rgba(255, 255, 255, 0.1); }
        .tab-active { background: rgba(168, 85, 247, 0.2); border-color: #a855f7; color: #d8b4fe; }
        #modal, #book-modal, #rename-modal { display: none; position: fixed; inset: 0; z-index: 100; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); flex-direction: column; justify-content: flex-end; align-items: center; padding: 10px; }
        .modal-content { width: 100%; max-width: 450px; background: #111827; border-radius: 24px; border-top: 1px solid rgba(168, 85, 247, 0.3); padding-bottom: env(safe-area-inset-bottom); }
        input, select { background: #1f2937 !important; border: 1px solid #374151 !important; color: white !important; border-radius: 12px !important; font-size: 16px !important; padding: 12px !important; }
        .list-card { background: rgba(31, 41, 55, 0.4); border: 1px solid rgba(255, 255, 255, 0.03); margin-bottom: 8px; }
        .loader { border-top-color: #facc15; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-24">

    <div id="loading-overlay" class="fixed inset-0 z-[200] hidden flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="loader w-12 h-12 border-4 border-slate-700 rounded-full"></div>
    </div>

    <div id="auth-screen" class="fixed inset-0 z-[110] flex items-center justify-center bg-[#030712] p-8">
        <div class="w-full max-w-sm text-center">
            <h1 class="text-3xl font-extrabold mb-2 text-yellow-400 tracking-tighter">mnote001</h1>
            <p class="text-slate-500 text-xs uppercase tracking-[0.3em] mb-12">Cloud Finance Portfolio</p>
            <div class="space-y-4">
                <input type="email" id="auth-email" placeholder="Email Address" class="w-full outline-none">
                <input type="password" id="auth-password" placeholder="Password" class="w-full outline-none">
                <div class="flex gap-3 pt-4">
                    <button onclick="handleSignIn()" class="flex-1 bg-yellow-400 text-black py-4 rounded-xl font-bold active:scale-95 transition">Login</button>
                    <button onclick="handleSignUp()" class="flex-1 border border-slate-700 py-4 rounded-xl font-bold text-slate-300">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <div id="app-screen" class="hidden">
        <header class="p-4 sticky top-0 z-40 bg-[#030712]/90 backdrop-blur-md border-b border-white/5">
            <div class="flex justify-between items-center px-1 mb-3">
                <div class="flex items-center gap-1">
                    <select id="book-selector" onchange="switchBook()" class="bg-transparent border-none text-yellow-400 font-bold text-base focus:ring-0 p-0 pr-6 max-w-[150px] truncate"></select>
                    <button onclick="openRenameModal()" class="text-slate-500 p-1"><i class="fa-solid fa-pen text-[10px]"></i></button>
                    <button onclick="openBookModal()" class="text-slate-500 p-1"><i class="fa-solid fa-folder-plus text-[10px]"></i></button>
                </div>
                <button onclick="handleSignOut()" class="text-slate-400 p-2"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
            <div class="flex gap-2">
                <select id="filter-month" onchange="render()" class="p-2 text-[10px] flex-1 outline-none"></select>
                <select id="filter-year" onchange="render()" class="p-2 text-[10px] w-20 outline-none"></select>
            </div>
        </header>

        <main class="p-4 space-y-6">
            <div class="p-7 rounded-[2rem] balance-gradient shadow-2xl relative overflow-hidden">
                <p id="active-book-title" class="text-white/70 text-[9px] font-bold uppercase tracking-widest mb-1"></p>
                <h1 id="bal-total" class="text-5xl font-extrabold text-white tracking-tighter mb-6">0</h1>
                <div class="flex gap-4 pt-5 border-t border-white/10">
                    <div class="flex-1 space-y-1 text-green-300 font-bold">Inflow
